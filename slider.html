<html>
	<head>
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
		<script type="text/javascript" src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
		<script type="text/javascript" src="currencies.js"></script>
		<script type="text/javascript" src="calculations.js"></script>
		<script type="text/javascript" src="date-support.js"></script>
		<link type="text/css" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" rel="stylesheet" />
		<link type="text/css" href="bootstrap.min.css" rel="stylesheet" />
		<link type="text/css" href="slider.css" rel="stylesheet" />
	</head>

	<body>
		<div id="calc-container">
		    <div id="calc-leftpanel">
		        <div id="left-top">
		        	<div id="lt-top">
			        	<div id="left-header" class="calc-header">Sample Rate and Payment Calculator</div>
			        	<div id="left-head-text"></div>
			        	<div>
			        		<select id="currency" class="selection span2">
							    <option value="0" selected="selected">Select Currency</option>
							    <option value="1">Something</option>
							    <option value="2">Something else</option>
							    <option value="3">Another choice</option>
							</select>
							<label id="check-discount" class="checkbox">
						    	<input id="checkbox-discount" type="checkbox"> <p class="input-label">I currently have discount terms</p>
						    </label>
			        	</div>
			        </div>
			        <div id="lt-middle">
			        	<div class="controls controls-row input-row">
			        		<div class="span2 input-box">
				        		<label class="input-label">Invoice Value</label>
				        		<input id="inv-val" class="input-dimension" type="text" placeholder="Invoice Value">
				        	</div>
				        	<div class="span2 input-box">
				        		<label class="input-label">SCF Financing (% APR)*</label>
				        		<input id="scf-percent" class="input-dimension" type="text" placeholder="SCF Financing %">
				        	</div>
				        	<div class="span2 input-box">
				        		<label class="input-label">Net Days</label>								
								<input id="net-days" class="input-dimension" type="text" placeholder="Net Days">
							</div>
						</div>
						<div class="controls controls-row input-row">
							<div class="span2 input-box scc">
								<label class="input-label">Supplier Cost of Capital</label>
								<input id="supp-cost-cap" class="input-dimension" type="text" placeholder="Supplier Cost of Capital">
							</div>
							<div class="span2 input-box discount">
								<label class="input-label">Discount %</label>
								<input id="disc-percent" class="input-dimension" type="text" placeholder="Discount %">
							</div>
							<div class="span2 input-box discount">
								<label class="input-label">Discount Days</label>						
								<input id="disc-days" class="input-dimension" type="text" placeholder="Discount Days">
							</div>
						</div>
			        </div>
			        <div id="lt-bottom">
			        	<div id="lt-bottom-text" class="input-label">When do you want your recievable?</div>
			        	<div id="slider-result">
			        		<div id="result-day" class="calc-header" style="float:left;"></div>
			        		<div id="result-text" style="float:left; margin-left:2%; font-weight:lighter;"></div>
			        	</div>
			        	<div id="start-date" style="float:left; clear:both; width:20%"></div>
		            	<div style="width:52%; float:left;">
		            		<div class="calc-slider"></div>
		            	</div>
		            	<div id="end-date" style="float:right; font-size:1.1em; width:20%"></div>		            	  
		            	<!--input type="hidden" id="hidden"/-->
	            	</div>
        		</div>
        		<div id="left-bottom">
        			<div id="button-div">
        				<button class="btn button-text">Save Scenario</button>
        				<button class="btn button-text">Get LIBOR</button>
        			</div>
        		</div>
		    </div>
		    <div id="calc-rightpanel">
		        <div id="right-top">
		        	<div id="right-header" class="calc-header">Scenario Results</div>
		        </div>
		        <div id="right-middle">
		        	<div id="pre-scf" class="result-field"></div>
		        	<div id="post-scf" class="result-field"></div>
		        	<div id="cost-reduction" class="result-field"></div>
		        	<div id="percent-improv" class="result-field"></div>
		        	<div id="account-cash" class="result-field"></div>
		        </div>
		        <div id="right-bottom">
		        	<div id="right-bottom-text"></div>
		        </div>
		    </div>
		</div>
		<div id="info-panel">
			<div id="info-top">
				<div id="info-close" style="float:right; cursor:pointer"><img src="close.png"/></div>
				<div id="info-header"></div>
				
			</div>
			<div id="info-bottom">
				<div id="info-text"></div>
			</div>
		</div>

		<script type="text/javascript">

		netDays = 60;
		dayOfPayment = 10;
		startDate = new Date;
		endDate = new Date;
		endDate.addDays(netDays);
		yearDays = 360;

		$("#checkbox-discount").click( function() {
    		if($(this).is(":checked")){
    			$('.discount').show();
    		}else{
    			$('.discount').hide();
    		}

		});

		$("#info-close").click( function() {
			$('#info-panel').hide();
		});

		$(document).ready(function(){

			if($(this).is(":checked")){
    			$('.discount').show();
    		}else{
    			$('.discount').hide();
    		}
			
			$( ".calc-slider").slider({
					animate: true,
					range: "min",
					value: dayOfPayment,
					min: 0,
					max: netDays,
					step: 1,

					//this gets a live reading of the value and prints it on the page
					slide: function( event, ui ) {

					   //$( "#slider-result" ).html( ui.value );
						updateAll(ui.value);
					},

					//this updates the hidden form field so we can submit the data using a form
					change: function(event, ui) {
					$('#hidden').attr('value', ui.value);
					}
			});
			
			updateAll(dayOfPayment);
		});
		function updateAll(days){

			buyerName = "Heinz";
			if (buyerName.length == 0){
				buyerName = "this buyer"
			}
			
			$("#left-head-text").html(
				"Say you sent an invoice to " + buyerName + " today. What would it cost to get paid early? Use the input fields and the date slide to run numbers on some different financing scenarios. You can save and load your sample scenarios for easy comparison."
			);
			
			$("#right-bottom-text").html(
				"*SCF Financing cost based on " + buyerName + " credit rating and may vary. For more information, questions about this calculator or to review the financial impact of SCF on your recievables, please contact "+ "<a href='#'>PrimeRevenue Supplier Solutions</a>" +" directly."
			);

			$("#start-date").html(startDate.getDate() + " " + startDate.getMonthName());
			$("#end-date").html(endDate.getDate() + " " + endDate.getMonthName());

			resultDate = new Date;
		 	resultDate.addDays(days);
			$("#result-day").html(resultDate.getDate() + " " + resultDate.getMonthName() + ", " + resultDate.getFullYear())
			daysEarly = netDays - days;
			$("#result-text").html("( " + daysEarly + " Days Early )");
			
			calculate(days);
		}

		function calculate(days){

			invoiceValue = $('#inv-val').val();
			scfPercent = $('#scf-percent').val();
			paymentTerm = $('#net-days').val();
			supplierCostCapital = $('#supp-cost-cap').val();
			discountPercent = $('#disc-percent').val();
			discountDays = $('#disc-days').val();
			daysEarly = netDays - days;

			postScfFinancingCost = roundNumber((invoiceValue/yearDays)*daysEarly*(scfPercent/100)).toFixed(2);
			$('#post-scf').html("<label class='result-label'>Post SCF Financing based on " + scfPercent + "% APR: <i class='icon-info-sign post-scf'></i></label><label class='result-value'>" + postScfFinancingCost + "</label>");

			if(supplierCostCapital != 0){

				preScfFinancingCost = roundNumber((invoiceValue/yearDays)*netDays*(supplierCostCapital/100)).toFixed(2);
				costReduction = roundNumber(preScfFinancingCost - postScfFinancingCost).toFixed(2);
				improvement = roundNumber((costReduction/preScfFinancingCost)*100).toFixed(2);

				$('#pre-scf').html("<label class='result-label'>Pre SCF Financing Costs: <i class='icon-info-sign pre-scf'></i></label><label class='result-value'>" + preScfFinancingCost + "</label>");
				$('#cost-reduction').html("<label class='result-label'>Supply Chain Price Reduction Potential: <i class='icon-info-sign cost-reduction'></i></label><label class='result-value'>" + costReduction + "</label>");
				$('#percent-improv').html("<label class='result-label'>Percent Improvement: <i class='icon-info-sign percent-improv'></i></label><label class='result-value'>" + improvement + " %</label>");

				$('#pre-scf').show();
				$('#cost-reduction').show();
				$('#percent-improv').show();
			}
			else{
				$('#pre-scf').hide();
				$('#cost-reduction').hide();
				$('#percent-improv').hide();
			}

			resultDate = new Date;
		 	resultDate.addDays(days);
			accountCash = roundNumber(invoiceValue - postScfFinancingCost).toFixed(2);
			$('#account-cash').html("<label class='result-label'>Cash in your account on " + resultDate.getDate() + " " + resultDate.getMonthName() + ", " + resultDate.getFullYear() + ": <i class='icon-info-sign account-cash'></i></label><label class='result-value'>" + accountCash + "</label>");
			

			$(".icon-info-sign").click( function(event) {
				showInfoPanel(event);
			});
		}

		function roundNumber(num) {
			var result = Math.round(num*Math.pow(10,2))/Math.pow(10,2);
			return result;
		}

		function showInfoPanel(event) {
		
			if($(event.target).hasClass('pre-scf')){
				calculationText(calculations.preScf);
			}
			else if($(event.target).hasClass('post-scf')){
				calculationText(calculations.postScf);
			}
			else if($(event.target).hasClass('cost-reduction')){
				calculationText(calculations.costReduction);
			}
			else if($(event.target).hasClass('percent-improv')){
				calculationText(calculations.improvement);
			}
			else if($(event.target).hasClass('account-cash')){
				calculationText(calculations.accountCash);
			}
			
		}

		function calculationText(obj){
			$('#info-header').html(obj.title);
			$('#info-text').html(obj.formula);
			$('#info-panel').show();
		}
	
		</script>
	</body>
</html>